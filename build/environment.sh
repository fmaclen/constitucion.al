#!/usr/bin/env bash

username=${USER-vagrant}

echo "-----> Loading environment from .profile.d for user $username"

cat > /home/$username/.bash_login <<EOF
# THIS FILE IS AUTOGENERATED BY AND WILL BE OVERWRITTEN
[[ -f ~/.bashrc ]] && source ~/.bashrc
cd
EOF
chown $username:$username /home/$username/.bash_login

# Prepend Heroku-style environment settings auto-loaded for user to system
# .bashrc
grep '.profile.d' /home/$username/.bashrc 1>&2 ||
  (echo '[ -e /app/.profile.d ] && for file in /app/.profile.d/*; do source $file; done' | cat - /home/$username/.bashrc > /tmp/.bashrc && mv /tmp/.bashrc /home/$username/.bashrc)
chown $username:$username /home/$username/.bashrc
